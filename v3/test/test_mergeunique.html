<!DOCTYPE html>
<html>
  <head>
    <!-- requirejs config -->
    <script>
      var require = {
        baseUrl : '../', 
      };
    </script>
    <!-- requirejs -->
    <script type="text/javascript" src="../../lib/require.js"></script>
    <!--  main -->
    <script text="javascript">

      require(['util/mergeunique'], function (mergeunique) {

        var makeBatch = function (size, random, scale) {
          let batch = [];
          random = random || false;
          scale = scale || 1;
          for (let i=0; i<size; i++) {
            if (random) {
              low = Math.random()*scale;
            } else {
              low = i;
            }
            batch.push(low);
          }
          return batch;
        };

        var timeit = function (func, name) {
          let t0 = performance.now();
          let result = func();
          let t1 = performance.now();
          console.log(name, t1-t0);
          return result;
        };


        var SIZE = 1000000;
        var SCALE = 1000000;
       
        var test_sort_unique = function () {
          let batch = Array.from({length: SIZE}, () => Math.floor(Math.random() * SCALE));
          timeit(function () {
            mergeunique.sort_unique(batch);
          }, "sort_unique");        
        };


        var Point = function (num) {
          this.num = num;
        };

        var getValue = function(point) {
          return point.num;
        };

        var cmp = function (a,b) {
          return getValue(a) - getValue(b);
        };

        var test_sort_unique = function () {
          let batch = Array.from({length: SIZE}, () => Math.floor(Math.random() * SCALE));
          timeit(function () {
            mergeunique.sort_unique(batch);
          }, "sort_unique");        
        };

        var test_unique_sort = function () {
          let batch = Array.from({length: SIZE}, () => Math.floor(Math.random() * SCALE));
          timeit(function () {
            mergeunique.unique_sort(batch);
          }, "unique_sort");      
        };

        var test_unique_sort_map = function () {
          let batch = Array.from({length: SIZE}, () => Math.floor(Math.random() * SCALE));
          let points = batch.map(i => new Point(i));
          timeit(function () {
            mergeunique.unique_sort_map(points, getValue, cmp);
          }, "unique_sort_map");        
        };

        var test_correct = function () {
          let batch1 = Array.from({length: 100}, () => Math.floor(Math.random() * 10));
          let batch2 = mergeunique.sort_unique(batch1);
          let batch3 = mergeunique.unique_sort(batch1);
          console.log(batch2);
          console.log(batch3);
        };

        var test_mergeunique = function () {
          let A = Array.from({length: SIZE/2}, () => Math.floor(Math.random() * SCALE/2));
          A = mergeunique.sort_unique(A);
          let B = Array.from({length: SIZE/2}, () => Math.floor(Math.random() * SCALE/2));
          timeit(function () {
            mergeunique.mergeunique(A, B);
          }, "mergeunique");
        };

        var test_mergeunique2 = function () {
          let A = Array.from({length: SIZE/2}, () => Math.floor(Math.random() * SCALE/2));
          A = mergeunique.sort_unique(A);
          let B = Array.from({length: SIZE/2}, () => Math.floor(Math.random() * SCALE/2));
          timeit(function () {
            mergeunique.mergeunique2(A, B);
          }, "mergeunique2");
        };

        var test_mergeunique3 = function () {
          let A = Array.from({length: SIZE/2}, () => Math.floor(Math.random() * SCALE/2));
          A = mergeunique.sort_unique(A);
          let B = Array.from({length: SIZE/2}, () => Math.floor(Math.random() * SCALE/2));
          timeit(function () {
            mergeunique.mergeunique3(A, B);
          }, "mergeunique3");
        };

        var test_correct_mergeunique = function() {
          let A = Array.from({length: 100}, () => Math.floor(Math.random() * 10));
          A = mergeunique.sort_unique(A);
          let B = Array.from({length: 100}, () => Math.floor(Math.random() * 10));
          let C = mergeunique.mergeunique(A, B);
          console.log(C);
        };

        var run = function () {
          // test_correct();          
          // test_sort_unique();
          test_unique_sort();
          test_unique_sort_map();
          // test_mergeunique();
          // test_mergeunique2();
          // test_mergeunique3();
          //test_correct_mergeunique();
        };

        if (document.readyState === "complete") run();
        else window.onload = run;
      });
    </script>    
  </head>
  <body>
    <h1>Test Merge Unique</h1>
  </body>
</html>