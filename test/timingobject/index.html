<!DOCTYPE html>

<html>
<head>
  <!-- requirejs config -->
  <script>
    var require = {
      baseUrl : '../../source/timingobject',
      paths : {
        util : '../util',
      }
    };
  </script>
  <script type="text/javascript" src="../require.js"></script>

  <script type="text/javascript">
      var m, w;
      require(['timingobject'], function (timingobject) {
      
        var run = function () {

          // timing object
          var to = new timingobject.TimingObject([8,17]);
          //var to = new timingobject.TimingObject();

          // wrapper object

          w = new timingobject.PositionShiftWrapper(to, 2);
          //w = new timingobject.DelayWrapper(to, 1.0);          
          //w = new timingobject.TimeShiftWrapper(to, -1.0);
          //w = new timingobject.ScaleWrapper(to, 2);
          //w = new timingobject.LoopWrapper(to, [2, 8]);
          //w = new timingobject.RangeWrapper(to, [10,15]);
          //w = new timingobject.DerivativeWrapper(to);


          var wrapperhandler = function () {
            if (wrapperhandler.init === false) {
              console.log("wrapper range", w.range);
              wrapperhandler.init = true;
            }
            console.log("wrapper onchange", w.vector);
          };
          wrapperhandler.init = false;

          var sourcehandler = function () {
            if (sourcehandler.init === false) {
              console.log("source range", to.range);
              sourcehandler.init = true;
            }
            console.log("source onchange", to.vector);
          };
          sourcehandler.init = false;

          if (w) w.on("change", wrapperhandler);
          to.on("change", sourcehandler);

          // Hook up buttons UI
          document.getElementById('srcplay').onclick = function () {to.update({velocity:1.0});};
          document.getElementById('srcpause').onclick = function () {to.update({velocity:0.0});};
          document.getElementById('srcreset').onclick = function () {to.update({position: 0.0, velocity:0.0});};
          document.getElementById('srcback').onclick = function () {to.update({velocity:-1.0});};
        
          if (w) {    
            document.getElementById('wrapperplay').onclick = function () {w.update({velocity:1.0});};
            document.getElementById('wrapperpause').onclick = function () {w.update({velocity:0.0});};
            document.getElementById('wrapperreset').onclick = function () {w.update({position: 0.0, velocity:0.0});};
            document.getElementById('wrapperback').onclick = function () {w.update({velocity:-1.0});};
          }

          // Hook up text UI
          var srcvalue = document.getElementById('srcvalue');
          var wrappervalue = document.getElementById('wrappervalue');
          to.on("timeupdate", function () {
            srcvalue.innerHTML = to.query().position.toFixed(2); 
          });
          if (w) {
            w.on("timeupdate", function () {
              wrappervalue.innerHTML = w.query().position.toFixed(2);
              srcvalue.innerHTML = to.query().position.toFixed(2); 
            });
          }
          
          
        };
        if (document.readyState === "complete") run();
        else window.onload = run;
      });
</script>
</head>
<body>
<h1>Test Chaining</h1>

<h3>Source</h3>
<div id="srcvalue"></div>
<button id="srcplay">Play</button>
<button id="srcpause">Pause</button>
<button id="srcreset">Reset</button>
<button id="srcback">Back</button>

<h3>Wrapper</h3>
<div id="wrappervalue"></div>
<button id="wrapperplay">Play</button>
<button id="wrapperpause">Pause</button>
<button id="wrapperreset">Reset</button>
<button id="wrapperback">Back</button>

</body>
</html>
