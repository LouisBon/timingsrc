<!DOCTYPE html>

<html>
<head>
  <!-- requirejs config -->
  <script>
    var require = {
      baseUrl : '../source',
    };
  </script>
  <script type="text/javascript" src="../lib/require.js"></script>
  <script type="text/javascript">
      var m, w;
      require(['timingsrc'], function (timingsrc) {
      
        var run = function () {

          // timing object
          var to = new timingsrc.TimingObject({range:[8,17]});
          //var to = new timingsrc.TimingObject();

          // Converter objects
          w = new timingsrc.SkewConverter(to, 2);
          //w = new timingsrc.DelayConverter(to, 1.0);          
          //w = new timingsrc.TimeShiftConverter(to, -1.0);
          //w = new timingsrc.ScaleConverter(to, 2);
          //w = new timingsrc.LoopConverter(to, [2, 8]);
          //w = new timingsrc.RangeConverter(to, [10,15]);
          //w = new timingsrc.DerivativeConverter(to);


          var converterhandler = function () {
            if (converterhandler.init === false) {
              console.log("converter range", w.range);
              converterhandler.init = true;
            }
            console.log("converter onchange", w.vector);
          };
          converterhandler.init = false;

          var sourcehandler = function () {
            if (sourcehandler.init === false) {
              console.log("source range", to.range);
              sourcehandler.init = true;
            }
            console.log("source onchange", to.vector);
          };
          sourcehandler.init = false;

          if (w) w.on("change", converterhandler);
          to.on("change", sourcehandler);

          // Hook up buttons UI
          document.getElementById('srcplay').onclick = function () {to.update({velocity:1.0});};
          document.getElementById('srcpause').onclick = function () {to.update({velocity:0.0});};
          document.getElementById('srcreset').onclick = function () {to.update({position: 0.0, velocity:0.0});};
          document.getElementById('srcback').onclick = function () {to.update({velocity:-1.0});};
        
          if (w) {    
            document.getElementById('converterplay').onclick = function () {w.update({velocity:1.0});};
            document.getElementById('converterpause').onclick = function () {w.update({velocity:0.0});};
            document.getElementById('converterreset').onclick = function () {w.update({position: 0.0, velocity:0.0});};
            document.getElementById('converterback').onclick = function () {w.update({velocity:-1.0});};
          }

          // Hook up text UI
          var srcvalue = document.getElementById('srcvalue');
          var convertervalue = document.getElementById('convertervalue');
          to.on("timeupdate", function () {
            srcvalue.innerHTML = to.query().position.toFixed(2); 
          });
          if (w) {
            w.on("timeupdate", function () {
              convertervalue.innerHTML = w.query().position.toFixed(2);
              srcvalue.innerHTML = to.query().position.toFixed(2); 
            });
          }
          
          
        };
        if (document.readyState === "complete") run();
        else window.onload = run;
      });
</script>
</head>
<body>
<h1>Test Timing Object</h1>

<h3>Source</h3>
<div id="srcvalue"></div>
<button id="srcplay">Play</button>
<button id="srcpause">Pause</button>
<button id="srcreset">Reset</button>
<button id="srcback">Back</button>

<h3>Converter</h3>
<div id="convertervalue"></div>
<button id="converterplay">Play</button>
<button id="converterpause">Pause</button>
<button id="converterreset">Reset</button>
<button id="converterback">Back</button>

</body>
</html>
